{% extends "layouts/map-layout.html" %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}

{% set pageName="Define Red Line Boundary" %}

{% block pageTitle %}
  Define Red Line Boundary - GOV.UK Prototype Kit
{% endblock %}

{% block backLink %}
  {{ govukBackLink({
    href: "/"
  }) }}
{% endblock %}

{% block mapAttributes %}data-mode="red-line-boundary"{% endblock %}

{% block leftPanelContent %}
  <h2 class="govuk-heading-m">Drawing Controls</h2>
  
  <ul class="map-controls-list">
    <li>
      <a href="#" id="start-drawing" data-action="start">Draw Polygon</a>
    </li>
    <li>
      <a href="#" id="start-fill" data-action="fill">Fill Polygon</a>
    </li>
    <li style="display: none;">
      <a href="#" id="cancel-drawing" data-action="cancel">Cancel Drawing</a>
    </li>
    <li style="display: none;">
      <a href="#" id="cancel-fill" data-action="cancel-fill">Cancel Fill</a>
    </li>
    <li style="display: none;">
      <a href="#" id="confirm-fill" data-action="confirm-fill">Confirm Selection</a>
    </li>
    <li style="display: none;">
      <a href="#" id="clear-polygon" data-action="clear">Clear Polygon</a>
    </li>
    <li>
      <a href="#" id="save-boundary" class="disabled" data-action="save">Save Boundary</a>
    </li>
    <li>
      <a href="#" id="export-geojson" data-action="export">Export GeoJSON</a>
    </li>
  </ul>
  
  <div class="govuk-form-group govuk-!-margin-top-4">
    <div class="govuk-checkboxes govuk-checkboxes--small">
      <div class="govuk-checkboxes__item">
        <input class="govuk-checkboxes__input" id="snap-enabled" name="snap-enabled" type="checkbox" checked>
        <label class="govuk-label govuk-checkboxes__label" for="snap-enabled">
          Enable snapping to features
        </label>
      </div>
    </div>
    <div class="govuk-hint govuk-!-margin-top-2">
      When enabled, vertices snap to buildings, roads, and other features
    </div>
  </div>

  <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-top-4 govuk-!-margin-bottom-4">

  <div class="govuk-!-margin-bottom-2">
    <strong class="govuk-tag" id="zoom-display" style="font-size: 16px; padding: 8px 12px;">
      Zoom: --
    </strong>
  </div>
  <div>
    <span class="govuk-body-s" id="snap-status">
      Snapping disabled (zoom to level 14+)
    </span>
  </div>
  
  <div id="status-message" class="govuk-notification-banner govuk-!-margin-top-4" role="region" aria-labelledby="status-title" style="display: none; position: static; box-shadow: none; transform: none; left: auto;">
    <div class="govuk-notification-banner__header">
      <h2 class="govuk-notification-banner__title" id="status-title">
        Information
      </h2>
    </div>
    <div class="govuk-notification-banner__content">
      <p class="govuk-notification-banner__heading" id="status-text">
        Status message
      </p>
    </div>
  </div>
{% endblock %}

{% block rightPanelContent %}
  <h1 class="govuk-heading-l">
    Define Red Line Boundary
  </h1>
  
  <p class="govuk-body">
    Use the map to draw your site's red line boundary with intelligent snapping to buildings, roads, waterlines, and railways.
  </p>

  <div id="area-display" class="govuk-!-margin-top-4" style="display: none;">
    <h3 class="govuk-heading-s">Polygon Area</h3>
    <p class="govuk-body" style="font-size: 24px; font-weight: bold; color: #dc0000;">
      <span id="area-value">--</span> hectares
    </p>
    <p class="govuk-hint">
      (<span id="area-acres">--</span> acres)
    </p>
  </div>

  <div id="fill-selection-info" class="govuk-!-margin-top-4" style="display: none;">
    <h3 class="govuk-heading-s">Fill Selection</h3>
    <p class="govuk-body">
      <strong><span id="selection-count">0</span></strong> polygon(s) selected
    </p>
    <p class="govuk-body" style="font-size: 20px; font-weight: bold; color: #1d70b8;">
      <span id="selection-area">--</span> hectares
    </p>
    <p class="govuk-hint">
      Click on map areas to add or remove polygons from selection.
    </p>
  </div>

  <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-top-4 govuk-!-margin-bottom-4">

  <details class="govuk-details">
    <summary class="govuk-details__summary">
      <span class="govuk-details__summary-text">
        How to define a boundary
      </span>
    </summary>
    <div class="govuk-details__text">
      <p class="govuk-body">You can define your red-line boundary using two methods:</p>
      
      <h3 class="govuk-heading-s govuk-!-margin-top-4">Option 1: Fill Polygon (recommended)</h3>
      <p class="govuk-body">Select existing OS map features like fields, land parcels, or sites:</p>
      <ol class="govuk-list govuk-list--number">
        <li><strong>Zoom in to at least zoom level 14</strong> - Watch the zoom indicator turn green</li>
        <li>Click <strong>"Fill Polygon"</strong> to start selection mode</li>
        <li><strong>Click on a field or land area</strong> - it will highlight in blue when selected</li>
        <li>Click on <strong>adjacent areas</strong> to add them to your selection (they must be neighbouring)</li>
        <li>Click a selected polygon again to <strong>deselect</strong> it</li>
        <li>Click <strong>"Confirm Selection"</strong> when you're happy with the boundary</li>
      </ol>
      <div class="govuk-inset-text">
        <strong>Note:</strong> All selected polygons must be adjacent (touching). You cannot select disconnected areas.
      </div>

      <h3 class="govuk-heading-s govuk-!-margin-top-4">Option 2: Draw Polygon</h3>
      <p class="govuk-body">Manually draw your boundary with intelligent snapping:</p>
      <ol class="govuk-list govuk-list--number">
        <li><strong>Zoom in to at least zoom level 14</strong> - Watch the zoom indicator turn green</li>
        <li>Click <strong>"Draw Polygon"</strong> to start drawing mode</li>
        <li>Move your mouse near features - the cursor will snap to edges and corners</li>
        <li>Click to place each vertex</li>
        <li>Hover over the first vertex and click to <strong>close the polygon</strong></li>
      </ol>

      <h3 class="govuk-heading-s govuk-!-margin-top-4">Editing a completed polygon:</h3>
      <ol class="govuk-list govuk-list--number">
        <li><strong>Hover over any vertex</strong> - it will enlarge slightly</li>
        <li><strong>Click and drag</strong> the vertex to a new position</li>
        <li>To <strong>add a new vertex</strong>, hover over the polygon edge - a white circle appears</li>
        <li><strong>Click the white circle</strong> to insert a new vertex</li>
        <li>Click <strong>"Clear Polygon"</strong> to start over</li>
      </ol>

      <div class="govuk-inset-text govuk-!-margin-top-4">
        <strong>Visual feedback:</strong>
        <ul class="govuk-list govuk-list--bullet govuk-!-margin-top-2">
          <li><strong style="color: #1d70b8;">Blue highlight</strong> = selected polygon (Fill mode)</li>
          <li><strong style="color: #ff8c00;">Orange circle</strong> = snapped to a feature (Draw mode)</li>
          <li><strong style="color: #ff0000;">Red circle</strong> = hover over first vertex to close</li>
        </ul>
      </div>
    </div>
  </details>
{% endblock %}
